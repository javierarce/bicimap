(function(t){function o(o){for(var e,s,r=o[0],c=o[1],l=o[2],u=0,p=[];u<r.length;u++)s=r[u],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&p.push(i[s][0]),i[s]=0;for(e in c)Object.prototype.hasOwnProperty.call(c,e)&&(t[e]=c[e]);d&&d(o);while(p.length)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,o=0;o<a.length;o++){for(var n=a[o],e=!0,r=1;r<n.length;r++){var c=n[r];0!==i[c]&&(e=!1)}e&&(a.splice(o--,1),t=s(s.s=n[0]))}return t}var e={},i={app:0},a=[];function s(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,o,n){s.o(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,o){if(1&o&&(t=s(t)),8&o)return t;if(4&o&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&o&&"string"!=typeof t)for(var e in t)s.d(n,e,function(o){return t[o]}.bind(null,e));return n},s.n=function(t){var o=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(o,"a",o),o},s.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},s.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=o,r=r.slice();for(var l=0;l<r.length;l++)o(r[l]);var d=c;a.push([0,"chunk-vendors"]),n()})({0:function(t,o,n){t.exports=n("56d7")},"56d7":function(t,o,n){"use strict";n.r(o);n("e260"),n("e6cf"),n("cca6"),n("a79d");var e=n("2b0e"),i=function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{staticClass:"Home"},[n("transition",{attrs:{name:"slide-fade"}},[t.showAlert?n("Alert",{attrs:{title:t.alertTitle,description:t.alertDescription,footer:t.alertFooter}}):t._e()],1),n("transition",{attrs:{name:"slide-fade"}},[t.showAbout?n("About",{attrs:{updatedAt:t.updatedAt}}):t._e()],1),n("Map")],1)},a=[],s=(n("99af"),n("d3b7"),{DELETE:"DELETE",GET:"GET",POST:"POST",PUT:"PUT"}),r={Accept:"application/json","Content-Type":"application/json"},c={data:function(){return{localStorage:window.localStorage}},methods:{onError:function(t){console.log("Error: ",t)},delete:function(t,o){return window.fetch(t,{headers:r,method:s.DELETE,body:JSON.stringify(o)})},put:function(t,o){return window.fetch(t,{headers:r,method:s.PUT,body:JSON.stringify(o)})},post:function(t,o){return window.fetch(t,{headers:r,method:s.POST,body:JSON.stringify(o)})},get:function(t){return window.fetch(t,{headers:r,method:s.GET})},coordinatesToLatLon:function(t){return[t.lat,t.lon]},latLonToCoordinates:function(t){return{lat:t[0],lon:t[1]}},saveToLocalStorage:function(t,o){this.localStorage&&this.localStorage.setItem(t,JSON.stringify(o))},retrieveFromLocalStorage:function(t){if(this.localStorage){var o=this.localStorage.getItem(t);if(o)return JSON.parse(o)}},removeFromLocalStorage:function(t){this.localStorage&&this.localStorage.removeItem(t)},emptyLocalStorage:function(){this.localStorage&&this.localStorage.clear()},pluralize:function(t,o,n){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=o;return(!t||t>1)&&(i=n),e&&!1===e.showAmount?i:"".concat(t," ").concat(i)}}},l=n("a1bc"),d=n.n(l),u=function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{staticClass:"About",on:{click:t.onClickOutside}},[n("div",{staticClass:"About__inner has-transition",on:{click:t.onClickInside}},[n("div",{staticClass:"About__title"},[t._v("Acerca de Bicimap")]),n("div",{staticClass:"About__content"},[n("div",{staticClass:"About__description"},[n("p",[n("strong",{on:{click:t.reload}},[t._v("Bicimap")]),t._v(" ofrece una alternativa amable y usable a los mapas de bicis oficiales de "),n("a",{attrs:{href:"https://www.bicimad.com",target:"_blank"}},[t._v("BiciMAD")]),t._v(" y "),n("a",{attrs:{href:"https://bicing.barcelona/"}},[t._v("Bicing")]),t._v(".")])]),t._m(0),t._m(1),n("div",{staticClass:"About__footer"},[n("div",[t._v("Actualizado hace "),n("strong",{domProps:{innerHTML:t._s(t.updatedAt)}})]),t._m(2)])])]),n("div",{staticClass:"About__backdrop"})])},p=[function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{staticClass:"About__highlight"},[n("p",[t._v("Sigue el desarrollo del proyecto, sugiere mejoras e informa de errores en GitHub.")]),n("a",{staticClass:"Button About__button is-bold",attrs:{href:"https://github.com/javierarce/bicimap",title:"Visita el repositorio en GitHub",target:"_blank"}},[t._v("Accede al código")])])},function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("p",{staticClass:"is-small"},[t._v("Esta web utiliza datos de "),n("a",{attrs:{href:"https://www.openstreetmap.org/copyright",target:"_blank"}},[t._v("Nominatim")]),t._v(".")])},function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",[t._v("Creado por "),n("a",{attrs:{href:"https://twitter.com/javier",target:"_blank"}},[t._v("Javier Arce")]),t._v(" sobre una bici")])}],h={props:["updatedAt"],methods:{reload:function(){window.location.reload(!0)},onClickOutside:function(){window.bus.$emit(d.a.ACTIONS.TOGGLE_ABOUT)},onClickInside:function(t){t.target&&"A"!==t.target.tagName&&(t.stopPropagation(),t.preventDefault())}}},f=h,m=n("0c7c"),_=Object(m["a"])(f,u,p,!1,null,null,null),v=_.exports,g=function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{staticClass:"Alert",on:{click:t.onClickOutside}},[n("div",{staticClass:"Alert__backdrop"}),n("div",{staticClass:"Alert__content has-transition",on:{click:t.onClickAlert}},[n("div",{staticClass:"Alert__title",domProps:{innerHTML:t._s(t.title)}}),n("div",{staticClass:"Alert__description",domProps:{innerHTML:t._s(t.description)}}),t.footer?n("div",{staticClass:"Alert__footer",domProps:{innerHTML:t._s(t.footer)}}):t._e()])])},b=[],A={props:["title","description","footer"],methods:{onClickOutside:function(){window.bus.$emit(d.a.ACTIONS.TOGGLE_ALERT)},onClickAlert:function(t){t.target&&"A"!==t.target.tagName&&(t.stopPropagation(),t.preventDefault())}}},S=A,T=Object(m["a"])(S,g,b,!1,null,null,null),w=T.exports,C=function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{staticClass:"Map__container"},[n("Search"),n("div",{staticClass:"Map show-bikes",attrs:{id:"map"}})],1)},L=[],O=n("3835"),k=(n("d81d"),n("159b"),n("b680"),n("a15b"),n("1276"),n("ac1f"),n("7db0"),function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{staticClass:"Search"},[n("div",{staticClass:"Search__content"},[n("input",{ref:"search",staticClass:"Search__input",attrs:{type:"text",placeholder:t.placeholder},domProps:{value:t.q},on:{keyup:[t.onKeyUp,function(o){return!o.type.indexOf("key")&&t._k(o.keyCode,"enter",13,o.key,"Enter")?null:t.onSubmit.apply(null,arguments)}]}}),n("div",{staticClass:"Spinner Search__spinner"}),n("button",{staticClass:"Search__clean",on:{click:t.onClean}})])])}),y=[],E=(n("841c"),n("5319"),{mixins:[c],data:function(){return{placeholder:d.a.TEXTS.SEARCH_PLACEHOLDER,q:void 0}},watch:{q:function(t){t?this.$el.classList.add("is-filled"):this.$el.classList.remove("is-filled")}},methods:{onKeyUp:function(){this.q=this.$refs.search.value},onClean:function(t){t.preventDefault(),t.stopPropagation(),this.q=""},onSubmit:function(t){t.preventDefault(),t.stopPropagation(),this.search()},search:function(){if(this.q){var t="&polygon_geojson=1&format=json&addressdetails=1&namedetails=1&extratags=1",o="".concat(d.a.ENDPOINTS.NOMINATIM).concat(d.a.ENDPOINTS.SEARCH_URL,"?q=").concat(this.q,", ").concat(d.a.MAP.DEFAULT_SEARCH_LOCATION).concat(t);this.$el.classList.add("is-searching"),window.bus.$emit(d.a.ACTIONS.START_LOADING),this.get(o).then(this.onGetResult).catch((function(t){console.log(t)}))}},onGetResult:function(t){var o=this;t.json().then((function(t){if(o.$el.classList.remove("is-searching"),window.bus.$emit(d.a.ACTIONS.STOP_LOADING),t.length)window.bus.$emit(d.a.ACTIONS.SET_VIEW,t[0]);else{var n=d.a.TEXTS.NO_RESULTS_TITLE,e=d.a.TEXTS.NO_RESULTS_DESCRIPTION.replace("{q}",o.q),i='<a class="Button Alert__button" href="https://www.openstreetmap.org/search?query='.concat(o.q,"#map=").concat(d.a.MAP.ZOOM,"/").concat(d.a.MAP.LAT,"/").concat(d.a.MAP.LON,'" target="__blank">Añade este lugar en OSM</a>');window.bus.$emit(d.a.ACTIONS.TOGGLE_ALERT,n,e,i)}}))}}}),P=E,I=Object(m["a"])(P,k,y,!1,null,null,null),N=I.exports,D=function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{staticClass:"BikeStationPopup__content"},[n("div",{staticClass:"BikeStationPopup__header"},[n("div",{staticClass:"Station__id",domProps:{innerHTML:t._s(t.id)}}),n("span",{domProps:{innerHTML:t._s(t.street)}})]),n("div",{staticClass:"BikeStationPopup__body"},[n("div",{staticClass:"BikeStationPopup__description"},[n("div",{staticClass:"Items"},[n("div",{staticClass:"Item"},[n("div",{staticClass:"Item__icon is-bike"}),n("div",{staticClass:"Item__amount",domProps:{innerHTML:t._s(t.bikes)}})]),t.isBarcelona?n("div",{staticClass:"Item"},[n("div",{staticClass:"Item__icon is-ebike"}),n("div",{staticClass:"Item__amount",domProps:{innerHTML:t._s(t.eBikes)}})]):t._e(),n("div",{staticClass:"Item"},[n("div",{staticClass:"Item__icon is-base"}),n("div",{staticClass:"Item__amount",domProps:{innerHTML:t._s(t.bases)}})])])]),n("div",{staticClass:"BikeStationPopup__footer"},[n("a",{staticClass:"BikeStationPopup__address",attrs:{href:t.href,target:"_blank",title:"Abrir en Google Maps"},domProps:{innerHTML:t._s(t.address)}})])])])},M=[],B=(n("b0c0"),{mixins:[c],props:["location","city"],computed:{isBarcelona:function(){return"barcelona"===this.city},href:function(){return"https://www.google.com/maps/place/".concat(this.address,", ").concat(this.city,"/").concat(this.location.latitude,",").concat(this.location.longitude,",17z")},address:function(){var t="madrid"===this.city?this.location.address:this.location.streetName;return t.replace("C/","").replace("Calle","").replace(/\(.*?\)/,"")},bases:function(){return"madrid"===this.city?this.location.free_bases:this.location.slots},basesLabel:function(){return this.pluralize(location.free_bases,"base","bases",{showAmount:!1})},eBikes:function(){return this.location.electrical_bikes},eBikesLabel:function(){return this.pluralize(location.electrical_bikes,"e-bici","e-bicis",{showAmount:!1})},bikes:function(){return"madrid"===this.city?this.location.dock_bikes:this.location.mechanical_bikes},bikesLabel:function(){return this.pluralize(this.bikes,"bici","bicis",{showAmount:!1})},id:function(){return"madrid"===this.city?this.location.number:this.location.id},street:function(){var t="madrid"===this.city?this.location.name:this.location.streetName;return t.replace("C/","").replace("Calle","")}},methods:{onClickDirection:function(){window.bus.$emit(d.a.ACTIONS.ADD_POINT,[this.location.latitude,this.location.longitude])}}}),$=B,G=Object(m["a"])($,D,M,!1,null,null,null),x=G.exports,R=function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{staticClass:"AirStationPopup__content"},[n("div",{staticClass:"AirStationPopup__header",domProps:{innerHTML:t._s(t.station.name)}}),n("div",{staticClass:"AirStationPopup__body"},[n("div",{staticClass:"AirStationPopup__description",domProps:{innerHTML:t._s(t.description)}}),t.showPollutants?t._e():n("button",{staticClass:"AirStationPopup__more",on:{click:t.togglePollutatns}},[t._v("Ver detalles")]),t.showPollutants?n("div",{staticClass:"AirStationPopup__pollutants"},[t._l(t.pollutants,(function(o){return n("div",{key:o.id,staticClass:"AirStationPopup__pollutant"},[n("div",{staticClass:"AirStationPopup__pollutantName",domProps:{innerHTML:t._s(o.name)}}),n("div",{staticClass:"AirStationPopup__pollutantValue"},[n("span",{domProps:{innerHTML:t._s(o.quality.lastValue)}}),t._m(0,!0),t._v("a las "),n("span",{domProps:{innerHTML:t._s(t.time)}})])])})),t._m(1)],2):t._e(),n("a",{staticClass:"AirStationPopup__address",attrs:{href:t.href,target:"_blank",title:"Abrir en Google Maps"},domProps:{innerHTML:t._s(t.station.address)}})])])},j=[function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("span",{staticClass:"AirStationPopup__pollutantUnit"},[t._v("µg/m"),n("sup",[t._v(" 3")])])},function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{staticClass:"AirStationPopup__pollutantsInfo"},[n("a",{staticClass:"AirStationPopup__pollutantHelp",attrs:{href:"https://github.com/javierarce/aire-madrid/wiki/How-are-quality-indexes-calculated",target:"_blank"}},[t._v(" Más información")])])}],H=(n("4de4"),["muy mala","mala","regular","buena","muy buena"]),U={mixins:[c],props:["station"],data:function(){return{showPollutants:!1}},computed:{pollutants:function(){return this.station.pollutants.filter((function(t){return t.quality}))},href:function(){return"https://www.google.com/maps/search/?api=1&query=".concat(this.station.lat,",").concat(this.station.lng)},time:function(){var t=void 0;return this.pollutants.forEach((function(o){t=o.quality.time})),t?"".concat(t,"h"):"???"},quality:function(){return H[this.station.qualityIndex-1]},description:function(){return"La calidad del aire a las <strong>".concat(this.time,"</strong> es <strong>").concat(this.quality,"</strong>.")}},methods:{togglePollutatns:function(){this.showPollutants=!this.showPollutants}}},q=U,V=Object(m["a"])(q,R,j,!1,null,null,null),z=V.exports,F=n("e11e");n("2573");var J=["barcelona","madrid"],W=0,K={mixins:[c],components:{Search:N},data:function(){return{pointA:void 0,pointB:void 0,cluster:{},coordinates:void 0,expanded:!1,helpControl:null,madridLanes:{},barcelonaLanes:{},lanesControl:null,locateControl:null,map:{},marker:void 0,mode:W,modeControl:null,options:{},showLanes:!1,stations:[],you:void 0}},mounted:function(){var t=this;this.$nextTick((function(){t.bindEvents(),t.init(),window.map=t}))},watch:{showLanes:function(t){t?(this.map.addLayer(this.barcelonaLanes),this.map.addLayer(this.madridLanes)):(this.map.removeLayer(this.madridLanes),this.map.removeLayer(this.barcelonaLanes))},mode:function(t){var o=this;window.bus.markers.forEach((function(n){var e=n.getElement(),i=n.options.location,a=n.options.city;if(e){var s=o.getTooltipContent(i,a,t);n.setTooltipContent(s);var r=t?"free_bases":"dock_bikes",c="free_bases";"barcelona"===a&&(r=t?"slots":"bikes",c="slots"),e.classList.toggle("is-docks",r===c),e.classList.toggle("is-empty",0===i[r]),e.classList.toggle("is-low",i[r]>0&&i[r]<3),e.classList.toggle("is-ok",i[r]>=3&&i[r]<5),e.classList.toggle("is-good",i[r]>=5)}}))}},computed:{toggleButtonClass:function(){return this.expanded?"is-expanded":void 0}},methods:{bindEvents:function(){this.bindKeys(),window.bus.$off(d.a.ACTIONS.ADD_STATIONS),window.bus.$on(d.a.ACTIONS.ADD_STATIONS,this.onAddStations),window.bus.$off(d.a.ACTIONS.SET_VIEW),window.bus.$on(d.a.ACTIONS.SET_VIEW,this.onSetView),window.bus.$off(d.a.ACTIONS.ADD_POINT),window.bus.$on(d.a.ACTIONS.ADD_POINT,this.onGetPoint)},bindKeys:function(){var t=this;document.onkeydown=function(o){o=o||window.event,27===o.keyCode&&t.removeMarker()}},getPercentageOfBikes:function(t){var o=t.dock_bikes-t.reservations_count,n=t.total_bases;return Math.round(o/n.toFixed()*100)},getStationIconClassNames:function(t,o){var n=["BikeStationMarker"],e=this.mode?"free_bases":"dock_bikes";return"barcelona"===o&&(e=this.mode?"slots":"bikes"),n.push(this.mode?"is-docks":""),t&&(0===t[e]?n.push("is-empty"):t[e]<3?n.push("is-low"):t[e]>=3&&t[e]<5?n.push("is-ok"):t[e]>=5?n.push("is-good"):n.push("is-bad"),"madrid"!==o||t.activate?"barcelona"===o&&1!==t.status&&n.push("is-disabled"):n.push("is-disabled")),n.join(" ")},getAirIconClassNames:function(t){var o=["AirStationMarker"];return o.push("is-".concat(t.qualityIndex)),o.join(" ")},parseAddress:function(t){var o=[],n="road, house_number, city";n.split(", ").forEach((function(n){t&&t[n]&&o.push(t[n])}));var e="Lugar misterioso";return o.length&&(e=t["shop"]?"<strong>".concat(t["shop"],"</strong> / ").concat(o.join(", ")):o.join(", ")),e},onGetPoint:function(t){var o=this;if(console.log(this.pointA,this.pointB),this.pointA?this.pointB=t:this.pointA=t,this.pointA&&this.pointB){var n=this.pointA.reverse().join(","),e=this.pointB.reverse().join(",");fetch("/api/route?start=".concat(n,"&end=").concat(e)).then((function(t){t.json().then((function(t){var n=F["geoJSON"](t,{style:function(){return{interactive:!1,color:"#23D5AB",weight:8,opacity:.5}}});o.pointA=void 0,o.pointB=void 0,o.map.addLayer(n)}))})).catch((function(t){console.error(t)}))}},onSetView:function(t){var o=[t.lat,t.lon];this.coordinates={lat:o[0],lng:o[1]};var n=t.display_name.split(",")[0],e=t&&this.parseAddress(t.address)||void 0;this.addLocationMarker(o,n,e),this.map.setView(o,17)},onAddStations:function(t,o){this.stations[o]?this.updateStations(t,o):(this.stations[o]=t,J.forEach(this.addStationMarker.bind(this)))},updateStations:function(t,o){var n=this;this.stations[o]=t;var i=this.cluster.getLayers();i.forEach((function(t){var i=t.options.location.id,a=n.getStationByCityAndId(o,i);if(a){var s=n.getTooltipContent(a,o,n.mode),r=n.getStationIcon(a,o),c=e["a"].extend(x),l=new c({propsData:{location:a,city:o}});t.setPopupContent(l.$mount().$el),t.setTooltipContent(s),t.setIcon(r)}}))},getStationByCityAndId:function(t,o){return this.stations[t].find((function(t){return t.id===o}))},addLocationMarker:function(t,o,n){var e=this.getLocationIcon(location),i=F["marker"](t,{icon:e,location:location});this.bindLocationMarker(i,t,n),this.map.addLayer(i)},addStationMarker:function(t){var o=this,n=this.stations[t];n&&n.forEach((function(n){var i=e["a"].extend(x),a=new i({propsData:{location:n,city:t}}),s=[n.latitude,n.longitude],r=F["popup"]({className:"BikeStationPopup",offset:[0,12]}),c=o.getStationIcon(n,t);r.setContent(a.$mount().$el);var l=F["marker"](s,{icon:c,location:n,city:t});o.bindStationMarker(l,o.getTooltipContent(n,t,o.mode),r),o.cluster.addLayer(l),window.bus.markers.push(l)}))},addAirMarker:function(t){var o=F["popup"]({className:"AirStationPopup",offset:[0,12]}),n=this.getAirIcon(t),i=e["a"].extend(z),a=new i({propsData:{station:t}});o.setContent(a.$mount().$el);var s=F["marker"]([t.lat,t.lng],{icon:n,data:t}).addTo(this.map);s.bindPopup(o,{maxWidth:"auto"})},getAirIcon:function(t){return new F["divIcon"]({className:this.getAirIconClassNames(t),html:'<div class="AirStationMarker__inner"></div>',iconSize:[30,30],iconAnchor:new F["Point"](15,0)})},getLocationIcon:function(){return new F["divIcon"]({className:"LocationMarker",html:'<div class="LocationMarker__inner"></div>',iconSize:[30,30],iconAnchor:new F["Point"](15,0)})},getStationIcon:function(t,o){return new F["divIcon"]({className:this.getStationIconClassNames(t,o),html:'<div class="BikeStationMarker__inner"></div>',iconSize:[30,30],iconAnchor:new F["Point"](15,0)})},getTooltipContent:function(t,o,n){var e="madrid"===o?t.dock_bikes:t.bikes,i="madrid"===o?t.free_bases:t.slots,a=[this.pluralize(e,"bici","bicis"),this.pluralize(i,"base","bases")],s=n?a.reverse():a;return s.join(" / ")},bindLocationMarker:function(t,o,n){var e=this;t.on("click",(function(){e.map.setView(o,19,{animate:!0,easeLinearity:.5,duration:.5})})),t.bindTooltip(n,{direction:"top",offset:[0,-2],className:"LocationMarker__tooltip"})},bindStationMarker:function(t,o,n){t.on("click",(function(){setTimeout((function(){t.closeTooltip()}),100)})),t.on("mousemove",(function(){t.isPopupOpen()&&t.isTooltipOpen()&&t.closeTooltip()})),t.bindPopup(n,{maxWidth:"auto"}),t.bindTooltip(o,{direction:"top",offset:[0,-2],className:"BikeStationMarker__tooltip"})},init:function(){var t=this,o={scrollWheelZoom:!0,zoomControl:!0,maxBoundsViscosity:1,tap:!1},n=this.retrieveFromLocalStorage("bounds");n?(this.map=F["map"]("map",o),this.centerToBounds(n)):this.map=F["map"]("map",o).setView([d.a.MAP.LAT,d.a.MAP.LON],d.a.MAP.ZOOM),this.map.zoomControl.setPosition("topleft"),this.map.on("moveend",this.onMapMoveEnd),this.cluster=F["markerClusterGroup"]({disableClusteringAtZoom:14,spiderfyOnMaxZoom:!1,showCoverageOnHover:!1}),this.map.on("locationfound",(function(o){window.bus.$emit(d.a.ACTIONS.STOP_LOADING),t.locateControl.stopLoading();var n=o.latlng;t.map.setView(n,17,{animate:!0,easeLinearity:.5,duration:.5}),t.you&&t.you.remove();var e=new F["divIcon"]({className:"BikeStationMarker is-you",html:'<div class="BikeStationMarker__inner"></div>',iconSize:[30,30],iconAnchor:new F["Point"](15,0)});t.you=F["marker"](n,{icon:e}).addTo(t.map),t.you.on("click",(function(){t.map.setView(n,19,{animate:!0,easeLinearity:.5,duration:.5})}))})),this.map.on("locationerror",(function(o){window.bus.$emit(d.a.ACTIONS.STOP_LOADING),t.locateControl.stopLoading(),console.log("location error",o)})),this.addHelpControl(),this.addModeControl(),this.layer=F["tileLayer"]("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}"+(F["Browser"].retina?"@2x.png":".png"),{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:20,minZoom:0}).addTo(this.map),this.addLanes(),this.addAir(),this.map.whenReady(this.onMapReady)},onMapMoveEnd:function(){this.saveToLocalStorage("bounds",this.map.getBounds().toBBoxString())},onMapReady:function(){this.map.addLayer(this.cluster)},centerToBounds:function(t){try{var o=t.split(",").map(parseFloat),n=Object(O["a"])(o,4),e=n[0],i=n[1],a=n[2],s=n[3],r=new F["LatLngBounds"](new F["LatLng"](i,e),new F["LatLng"](s,a));this.map.fitBounds(r)}catch(c){console.log(c)}},addModeControl:function(){var t=this;F["Control"].ModeControl=F["Control"].extend({onRemove:function(){},onAdd:function(){var o=F["DomUtil"].create("div","Control is-hidden Control__mode"),n=F["DomUtil"].create("div","Control__modeBikes"),e=F["DomUtil"].create("div","Control__modeDocks");return F["DomEvent"].on(o,"dblclick",(function(t){t.stopPropagation(),t.preventDefault()})),F["DomEvent"].on(o,"click",(function(t){t.stopPropagation(),t.preventDefault()})),F["DomEvent"].on(o,"touchstart",(function(n){n.stopPropagation(),n.preventDefault(),t.mode=!t.mode,o.classList.toggle("is-docks",t.mode)})),o.appendChild(n),o.appendChild(e),setTimeout((function(){o.classList.remove("is-hidden")}),800),o}}),this.modeControl=new F["Control"].ModeControl({position:"topright"}).addTo(this.map)},addHelpControl:function(){F["Control"].HelpControl=F["Control"].extend({onRemove:function(){},onAdd:function(){var t=F["DomUtil"].create("div","Control is-hidden Control__help");return F["DomEvent"].on(t,"dblclick",(function(t){t.stopPropagation(),t.preventDefault()})),F["DomEvent"].on(t,"click",(function(t){t.stopPropagation(),t.preventDefault(),window.bus.$emit(d.a.ACTIONS.OPEN_ABOUT)})),setTimeout((function(){t.classList.remove("is-hidden")}),800),t}}),this.helpControl=new F["Control"].HelpControl({position:"topright"}).addTo(this.map)},addLanesControl:function(){var t=this;F["Control"].LanesControl=F["Control"].extend({onRemove:function(){},onAdd:function(){var o=F["DomUtil"].create("div","Control is-hidden Control__lanes");return F["DomEvent"].on(o,"dblclick",(function(t){t.stopPropagation(),t.preventDefault()})),F["DomEvent"].on(o,"click",(function(t){t.stopPropagation(),t.preventDefault()})),F["DomEvent"].on(o,"touchstart",(function(n){n.stopPropagation(),n.preventDefault(),t.showLanes=!t.showLanes,o.classList.toggle("is-selected",t.showLanes)})),setTimeout((function(){o.classList.remove("is-hidden")}),800),o}}),this.lanesControl=new F["Control"].LanesControl({position:"topright"}).addTo(this.map),this.addLocateControl()},addLocateControl:function(){var t=this;F["Control"].LocateControl=F["Control"].extend({startLoading:function(){t.locateControl._container.classList.add("is-loading")},stopLoading:function(){t.locateControl._container.classList.remove("is-loading")},onRemove:function(){},onAdd:function(){var o=F["DomUtil"].create("div","Control is-hidden Control__locate"),n=F["DomUtil"].create("div","Spinner is-mini");return o.appendChild(n),F["DomEvent"].on(o,"click",(function(t){t.stopPropagation(),t.preventDefault()})),F["DomEvent"].on(o,"touchstart",(function(o){o.stopPropagation(),o.preventDefault(),t.map.locate({setView:!1}),window.bus.$emit(d.a.ACTIONS.START_LOADING),t.locateControl.startLoading()})),setTimeout((function(){o.classList.remove("is-hidden")}),800),o}}),this.locateControl=new F["Control"].LocateControl({position:"topright"}).addTo(this.map)},addLanes:function(){this.get("/barcelona.geojson").then(this.onGetBarcelonaLanes.bind(this)).catch((function(t){console.error(t)})),this.get("/madrid.min.geojson").then(this.onGetMadridLanes.bind(this)).catch((function(t){console.error(t)}))},onGetBarcelonaLanes:function(t){var o=this;t.json().then((function(t){o.barcelonaLanes=F["geoJSON"](t,{style:function(){return{interactive:!1,color:"#23D5AB",weight:8,opacity:.5}}})}))},onGetMadridLanes:function(t){var o=this;t.json().then((function(t){o.madridLanes=F["geoJSON"](t,{style:function(){return{interactive:!1,color:"#23D5AB",weight:8,opacity:.5}}}),o.addLanesControl()}))},addAir:function(){this.get("/air.json").then(this.onGetAir.bind(this)).catch((function(t){console.error(t)}))},onGetAir:function(t){var o=this;t.json().then((function(t){t.forEach(o.addAirMarker.bind(o))}))},startLoading:function(){window.bus.$emit(d.a.ACTIONS.START_LOADING)},stopLoading:function(){window.bus.$emit(d.a.ACTIONS.STOP_LOADING)},removeMarker:function(){if(this.map.closePopup(),this.marker)return this.marker.remove(),this.marker=void 0,!0}}},Z=K,X=Object(m["a"])(Z,C,L,!1,null,null,null),Q=X.exports,Y=n("1556"),tt=n("d546"),ot=["madrid","barcelona"],nt={mixins:[c],components:{About:v,Alert:w,Map:Q},data:function(){return{alertDescription:void 0,alertFooter:void 0,alertTitle:void 0,locations:[],updatedAt:void 0,showAbout:!1,showAlert:!1}},mounted:function(){var t=this;this.$nextTick((function(){t.bindEvents(),t.loadStations(),window.home=t}))},methods:{bindEvents:function(){window.bus.$off(d.a.ACTIONS.START_LOADING),window.bus.$off(d.a.ACTIONS.STOP_LOADING),window.bus.$off(d.a.ACTIONS.TOGGLE_ABOUT),window.bus.$off(d.a.ACTIONS.OPEN_ABOUT),window.bus.$off(d.a.ACTIONS.TOGGLE_ALERT),window.bus.$off(d.a.ACTIONS.SHOW_ALERT),window.bus.$on(d.a.ACTIONS.START_LOADING,this.onStartLoading),window.bus.$on(d.a.ACTIONS.STOP_LOADING,this.onStopLoading),window.bus.$on(d.a.ACTIONS.TOGGLE_ABOUT,this.onToggleAbout),window.bus.$on(d.a.ACTIONS.OPEN_ABOUT,this.onOpenAbout),window.bus.$on(d.a.ACTIONS.TOGGLE_ALERT,this.onToggleAlert),window.bus.$on(d.a.ACTIONS.SHOW_ALERT,this.onShowAlert),document.onkeyup=this.onKeyUp},onKeyUp:function(t){t.preventDefault(),t.stopPropagation(),27===t.keyCode&&(this.showAlert=!1,this.showAbout=!1)},onStartLoading:function(){document.body.classList.add("is-loading")},onStopLoading:function(){document.body.classList.remove("is-loading")},onOpenAbout:function(){this.showAbout=!0},onToggleAbout:function(){this.showAbout=!this.showAbout},onShowAlert:function(t,o,n){this.showAlert=!0,this.alertTitle=t,this.alertDescription=o,this.alertFooter=n},onToggleAlert:function(t,o,n){this.showAlert=!this.showAlert,this.alertTitle=t,this.alertDescription=o,this.alertFooter=n},loadStations:function(){var t=this;console.log("Loading stations…"),this.getStations(),setInterval((function(){t.getStations()}),3e4)},getStations:function(){console.log("Getting stations…"),ot.forEach(this.getStationForCity.bind(this))},onGetStations:function(t,o){var n=this;t.json().then((function(t){n.updatedAt=Object(Y["a"])(t.updated_at,new Date,{locale:tt["a"]}),window.bus.$emit(d.a.ACTIONS.ADD_STATIONS,t.stations,o)}))},getStationForCity:function(t){var o=this;this.get("/".concat(t,".json?r=").concat(1e4*Math.random())).then((function(n){return o.onGetStations(n,t)})).catch((function(t){console.error(t)}))}}},et=nt,it=Object(m["a"])(et,i,a,!1,null,null,null),at=it.exports,st=(n("78a7"),n("9483"));Object(st["a"])("".concat("/","service-worker.js?v=1.0"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}}),window.bus=new e["a"]({data:function(){return{markers:[]}}}),new e["a"]({el:"#app",render:function(t){return t(at)}})},"78a7":function(t,o,n){},a1bc:function(t,o){var n={TITLE:"Bicimap",LAT:"40.41948626649347",LON:"-3.6930539666172475",ZOOM:"14",DEFAULT_SEARCH_LOCATION:"Madrid, Spain"},e={SEARCH_PLACEHOLDER:"Busca por dirección o comercio",NO_RESULTS_TITLE:"Dirección no encontrada",NO_RESULTS_DESCRIPTION:'<p><strong>Bicimap</strong> usa datos públicos de <a href="https://www.openstreetmap.org">OpenStreetMap</a>  y la dirección que has buscado ({q}) aún no se ha agregado.</p>'},i={ADD_MARKER:"add-marker",ADD_MARKERS:"add-markers",ADD_POINT:"add-point",ADD_STATION:"add-station",ADD_STATIONS:"add-stations",OPEN_ABOUT:"open-about",SELECT_MARKER:"select-marker",SET_VIEW:"set-view",SHOW_ALERT:"show-alert",START_LOADING:"start-loading",STOP_LOADING:"stop-loading",TOGGLE_ABOUT:"toggle-about",TOGGLE_ALERT:"toggle-alert",TOGGLE_LANES:"toggle-lanes",UPDATED_AT:"updated-at"},a={NOMINATIM:"https://nominatim.openstreetmap.org",SEARCH_URL:"/search.php"};t.exports={MAP:n,ENDPOINTS:a,TEXTS:e,ACTIONS:i}}});
//# sourceMappingURL=app.2add6203.js.map